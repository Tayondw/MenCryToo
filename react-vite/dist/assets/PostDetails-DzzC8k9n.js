import{j as e}from"./index-D9VjzoVj.js";import{r as s}from"./react-vendor-DWDxyCYt.js";import{e as t,u as a,L as r}from"./router-vendor-DFbjbkyO.js";import{a as i}from"./redux-vendor-s9F9CGgp.js";import{u as l,a as o,P as n,C as d,b as m,c}from"./useLikes-BeK_54-P.js";import{A as u,a0 as x,I as p,J as h,t as f,a1 as g,a2 as b,Q as j,a6 as N}from"./ui-vendor-BYqGaI5u.js";const v=()=>{var v;const w=t(),I=i(e=>e.session.user),y=a(),{likeStates:k,setLikeState:C,fetchLikeStatus:A}=l(),{isOpen:S,postId:z,openModal:L,closeModal:T}=o(),[D,E]=s.useState(!1),[M,R]=s.useState((null==(v=w.postComments)?void 0:v.length)||0),[$,_]=s.useState(""),[U,P]=s.useState(null),[B,O]=s.useState(""),[J,Q]=s.useState(!1),[W,q]=s.useState({}),[F,G]=s.useState(w.postComments||[]);s.useEffect(()=>{k.has(w.id)||(C(w.id,!1,w.likes),A(w.id))},[w.id,w.likes,k,C,A]);const H=s.useMemo(()=>k.get(w.id)||{isLiked:!1,likeCount:w.likes,isLoading:!1},[k,w.id,w.likes]),K=s.useCallback(()=>{L(w.id)},[L,w.id]),V=s.useCallback(e=>{const s=new Map,t=[];return e.forEach(e=>{let t;t=e.commenter?{id:e.commenter.id,username:e.commenter.username,firstName:e.commenter.firstName||"",lastName:e.commenter.lastName||"",profileImage:e.commenter.profileImage||"/default-avatar.png"}:I&&e.userId===I.id?{id:I.id,username:I.username,firstName:I.firstName||"",lastName:I.lastName||"",profileImage:I.profileImage||"/default-avatar.png"}:e.userId===w.user.id?{id:w.user.id,username:w.user.username,firstName:w.user.firstName,lastName:w.user.lastName,profileImage:w.user.profileImage}:{id:e.userId,username:e.username||"Unknown User",firstName:"",lastName:"",profileImage:"/default-avatar.png"};const a={id:e.id,userId:e.userId,postId:e.postId,comment:e.comment,parentId:e.parentId,createdAt:e.created_at,updatedAt:e.updated_at,commenter:t,replies:[]};s.set(e.id,a)}),e.forEach(e=>{const a=s.get(e.id);if(null===e.parentId)t.push(a);else{const t=s.get(e.parentId);t&&(t.replies||(t.replies=[]),t.replies.push(a))}}),t.sort((e,s)=>new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime()),t.forEach(e=>{e.replies&&e.replies.sort((e,s)=>new Date(e.createdAt).getTime()-new Date(s.createdAt).getTime())}),t},[w.user.id,I,w.user.firstName,w.user.lastName,w.user.profileImage,w.user.username]),X=s.useMemo(()=>F&&F.length>0?V(F):[],[F,V]),Y=s.useCallback(e=>{const s=new Date,t=new Date(e),a=Math.floor((s.getTime()-t.getTime())/36e5);if(a<1)return"just now";if(a<24)return`${a}h ago`;const r=Math.floor(a/24);return r<7?`${r}d ago`:t.toLocaleDateString()},[]),Z=async e=>{var s;if(I&&B.trim()){Q(!0);try{const t=ee(e),a=(null==(s=null==t?void 0:t.commenter)?void 0:s.username)||"",r=await c.createReply({comment:B.trim(),postId:w.id,parentId:e,replyToUsername:a}),i={id:r.comment.id,userId:I.id,postId:w.id,comment:B.trim(),username:I.username,parentId:e,created_at:r.comment.createdAt,updated_at:r.comment.updatedAt,commenter:{id:I.id,username:I.username,firstName:I.firstName||"",lastName:I.lastName||"",profileImage:I.profileImage||"/default-avatar.png"}};G(e=>[...e,i]),R(e=>e+1),O(""),P(null)}catch(t){}finally{Q(!1)}}},ee=e=>{for(const s of X){if(s.id===e)return s;if(s.replies)for(const t of s.replies)if(t.id===e)return t}return null},se=async(e,s)=>{try{await c.updateComment(e,s),G(t=>t.map(t=>t.id===e?{...t,comment:s}:t))}catch(t){throw t}},te=async e=>{try{await c.deleteComment(w.id,e),G(s=>{const t=s.filter(s=>s.id!==e&&s.parentId!==e);return R(t.length),t})}catch(s){throw s}},ae=(null==I?void 0:I.id)===w.creator,re=s.useCallback(e=>{q(s=>({...s,[e]:!s[e]}))},[]);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-orange-50 to-slate-100",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm border-b border-slate-200 sticky top-0 z-40",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs(r,{to:"/similar-feed",className:"inline-flex items-center gap-2 text-slate-600 hover:text-slate-900 font-medium transition-colors",children:[e.jsx(u,{size:20}),"Back to Posts"]}),ae&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>E(!D),className:"p-2 rounded-lg text-slate-600 hover:text-slate-900 hover:bg-slate-100 transition-colors",children:e.jsx(x,{size:20})}),D&&e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-slate-200 py-1 z-50",children:[e.jsxs("button",{onClick:()=>{y(`/posts/${w.id}/edit`),E(!1)},className:"flex items-center gap-2 w-full px-4 py-2 text-left text-slate-700 hover:bg-slate-100",children:[e.jsx(p,{size:16}),"Edit Post"]}),e.jsxs("button",{onClick:()=>{window.confirm("Are you sure you want to delete this post? This action cannot be undone."),E(!1)},className:"flex items-center gap-2 w-full px-4 py-2 text-left text-red-600 hover:bg-red-50",children:[e.jsx(h,{size:16}),"Delete Post"]})]})]})]})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-slate-100",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(r,{to:`/users/${w.user.id}`,className:"flex-shrink-0",children:e.jsx("img",{src:w.user.profileImage,alt:w.user.username,className:"w-12 h-12 rounded-full object-cover border-2 border-slate-200 hover:border-orange-500 transition-colors",onError:e=>{e.target.src="/default-avatar.png"}})}),e.jsxs("div",{children:[e.jsx(r,{to:`/users/${w.user.id}`,className:"font-semibold text-slate-900 hover:text-orange-600 transition-colors",children:w.user.username}),e.jsxs("div",{className:"flex items-center text-sm text-slate-500",children:[e.jsx(f,{size:14,className:"mr-1"}),e.jsx("span",{children:(ie=w.createdAt,new Date(ie).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}))})]})]})]})}),e.jsx("img",{src:w.image,alt:w.title,className:"w-full h-auto max-h-[600px] object-contain bg-slate-100"}),e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-4",children:w.title}),e.jsx("p",{className:"text-slate-700 whitespace-pre-line mb-6",children:w.caption}),e.jsxs("div",{className:"flex items-center justify-between border-t border-b border-slate-200 py-4 my-4",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx(n,{postId:w.id,initialLikeCount:H.likeCount,initialIsLiked:H.isLiked,onLikeToggle:(e,s,t)=>{C(e,s,t)},onLikesClick:K,size:20,disabled:H.isLoading}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-500",children:[e.jsx(g,{size:20}),e.jsx("span",{className:"font-medium",children:M})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"text-slate-500 hover:text-orange-500 transition-colors",children:e.jsx(b,{size:20})}),e.jsx("button",{className:"text-slate-500 hover:text-green-500 transition-colors",children:e.jsx(j,{size:20})})]})]}),I&&e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(r,{to:`/users/${I.id}`,className:"flex-shrink-0",children:e.jsx("img",{src:I.profileImage,alt:I.username,className:"w-10 h-10 rounded-full object-cover border-2 border-slate-200 hover:border-orange-500 transition-colors",onError:e=>{e.target.src="/default-avatar.png"}})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:$,onChange:e=>_(e.target.value),placeholder:"Write a comment...",className:"w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 resize-none",rows:3}),e.jsx("button",{onClick:async()=>{if(I&&$.trim()){Q(!0);try{const e=await c.createComment({comment:$.trim(),postId:w.id}),s={id:e.comment.id,userId:I.id,postId:w.id,comment:$.trim(),username:I.username,parentId:null,created_at:e.comment.createdAt,updated_at:e.comment.updatedAt,commenter:{id:I.id,username:I.username,firstName:I.firstName||"",lastName:I.lastName||"",profileImage:I.profileImage||"/default-avatar.png"}};G(e=>[s,...e]),R(e=>e+1),_("")}catch(e){}finally{Q(!1)}}},disabled:!$.trim()||J,className:"absolute bottom-3 right-3 p-2 bg-orange-500 text-white rounded-full hover:bg-orange-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:J?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(N,{size:16})})]})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h2",{className:"text-xl font-semibold text-slate-900",children:["Comments (",M,")"]})}),X.length>0?e.jsx("div",{className:"space-y-4",children:X.map(s=>e.jsx(d,{comment:s,depth:0,maxDepth:5,sessionUser:I,postUser:w.user,allComments:X,replyToComment:U,setReplyToComment:P,replyText:B,setReplyText:O,handleAddReply:Z,isSubmitting:J,formatTimeAgo:Y,showAllReplies:W,toggleShowAllReplies:re,onEdit:se,onDelete:te},s.id))}):e.jsxs("div",{className:"text-center py-8 bg-slate-50 rounded-lg",children:[e.jsx(g,{size:32,className:"mx-auto text-slate-300 mb-2"}),e.jsx("p",{className:"text-slate-600 mb-3",children:"No comments yet. Be the first to comment!"})]})]})]})]})}),S&&z&&e.jsx(m,{isOpen:S,onClose:T,postId:z,initialCount:H.likeCount})]});var ie};export{v as default};
