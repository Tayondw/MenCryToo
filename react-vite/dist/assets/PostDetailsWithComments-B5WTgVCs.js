import{j as e}from"./index-BStRFqEB.js";import{r as s,c as t}from"./react-vendor-DWDxyCYt.js";import{e as a,u as r,L as i}from"./router-vendor-DFbjbkyO.js";import{a as o}from"./redux-vendor-s9F9CGgp.js";import{u as l,a as n,b as d,P as m,C as c,c as u,d as p,e as x}from"./useLikes-DoZGE7rK.js";import{A as h,a0 as f,I as g,J as b,t as j,a1 as N,a2 as v,Q as w,a6 as I}from"./ui-vendor-DzNpKoho.js";const C=()=>{var C,k,y;const A=a(),z=o(e=>e.session.user),L=r(),{modal:T,openModal:S,closeModal:D}=l(),{likeStates:M,setLikeState:E,fetchLikeStatus:R}=n(),{isOpen:$,postId:_,openModal:U,closeModal:O}=d(),[P,B]=s.useState(!1),[J,Q]=s.useState(""),[V,W]=s.useState(null),[q,F]=s.useState(""),[G,H]=s.useState(!1),[K,X]=s.useState({});t.useEffect(()=>{M.has(A.id)||(E(A.id,!1,A.likes),R(A.id))},[A.id,A.likes,M,E,R]);const Y=s.useMemo(()=>M.get(A.id)||{isLiked:!1,likeCount:A.likes,isLoading:!1},[M,A.id,A.likes]),Z=s.useCallback(()=>{U(A.id)},[U,A.id]),ee=s.useCallback(e=>{const s=new Map,t=[];return e.forEach(e=>{let t;t=e.commenter?{id:e.commenter.id,username:e.commenter.username,firstName:e.commenter.firstName||"",lastName:e.commenter.lastName||"",profileImage:e.commenter.profileImage||"/default-avatar.png"}:z&&e.userId===z.id?{id:z.id,username:z.username,firstName:z.firstName||"",lastName:z.lastName||"",profileImage:z.profileImage||"/default-avatar.png"}:e.userId===A.user.id?{id:A.user.id,username:A.user.username,firstName:A.user.firstName,lastName:A.user.lastName,profileImage:A.user.profileImage}:{id:e.userId,username:e.username||"Unknown User",firstName:"",lastName:"",profileImage:"/default-avatar.png"};const a={id:e.id,userId:e.userId,postId:e.postId,comment:e.comment,parentId:e.parentId,createdAt:e.created_at,updatedAt:e.updated_at,commenter:t,replies:[]};s.set(e.id,a)}),e.forEach(e=>{const a=s.get(e.id);if(null===e.parentId)t.push(a);else{const t=s.get(e.parentId);t&&(t.replies=t.replies||[],t.replies.push(a))}}),t.sort((e,s)=>new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime()),t.forEach(e=>{e.replies&&e.replies.sort((e,s)=>new Date(e.createdAt).getTime()-new Date(s.createdAt).getTime())}),t},[A.user.id,z,A.user.firstName,A.user.lastName,A.user.profileImage,A.user.username]),se=s.useMemo(()=>A.postComments&&A.postComments.length>0?ee(A.postComments):[],[A.postComments,ee]),te=s.useCallback(e=>{const s=new Date,t=new Date(e),a=Math.floor((s.getTime()-t.getTime())/36e5);if(a<1)return"just now";if(a<24)return`${a}h ago`;const r=Math.floor(a/24);return r<7?`${r}d ago`:t.toLocaleDateString()},[]),ae=async e=>{var s;if(z&&q.trim()){H(!0);try{const t=re(e),a=(null==(s=null==t?void 0:t.commenter)?void 0:s.username)||"",r=await x.createReply({comment:q.trim(),postId:A.id,parentId:e,replyToUsername:a}),i={id:r.comment.id,userId:z.id,postId:A.id,comment:q.trim(),username:z.username,parentId:e,created_at:r.comment.createdAt,updated_at:r.comment.updatedAt};A.postComments=[...A.postComments,i],F(""),W(null)}catch(t){}finally{H(!1)}}},re=e=>{for(const s of se){if(s.id===e)return s;if(s.replies)for(const t of s.replies)if(t.id===e)return t}return null},ie=s.useCallback(()=>{S(A.id,se)},[S,A.id,se]),oe=(null==z?void 0:z.id)===A.creator,le=s.useCallback(e=>{X(s=>({...s,[e]:!s[e]}))},[]);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-orange-50 to-slate-100",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm border-b border-slate-200 sticky top-0 z-40",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs(i,{to:"/similar-feed",className:"inline-flex items-center gap-2 text-slate-600 hover:text-slate-900 font-medium transition-colors",children:[e.jsx(h,{size:20}),"Back to Posts"]}),oe&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>B(!P),className:"p-2 rounded-lg text-slate-600 hover:text-slate-900 hover:bg-slate-100 transition-colors",children:e.jsx(f,{size:20})}),P&&e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-slate-200 py-1 z-50",children:[e.jsxs("button",{onClick:()=>{L(`/posts/${A.id}/edit`),B(!1)},className:"flex items-center gap-2 w-full px-4 py-2 text-left text-slate-700 hover:bg-slate-100",children:[e.jsx(g,{size:16}),"Edit Post"]}),e.jsxs("button",{onClick:()=>{window.confirm("Are you sure you want to delete this post? This action cannot be undone."),B(!1)},className:"flex items-center gap-2 w-full px-4 py-2 text-left text-red-600 hover:bg-red-50",children:[e.jsx(b,{size:16}),"Delete Post"]})]})]})]})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-slate-100",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(i,{to:`/users/${A.user.id}`,className:"flex-shrink-0",children:e.jsx("img",{src:A.user.profileImage,alt:A.user.username,className:"w-12 h-12 rounded-full object-cover border-2 border-slate-200 hover:border-orange-500 transition-colors",onError:e=>{e.target.src="/default-avatar.png"}})}),e.jsxs("div",{children:[e.jsx(i,{to:`/users/${A.user.id}`,className:"font-semibold text-slate-900 hover:text-orange-600 transition-colors",children:A.user.username}),e.jsxs("div",{className:"flex items-center text-sm text-slate-500",children:[e.jsx(j,{size:14,className:"mr-1"}),e.jsx("span",{children:(ne=A.createdAt,new Date(ne).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}))})]})]})]})}),e.jsx("img",{src:A.image,alt:A.title,className:"w-full h-auto max-h-[600px] object-contain bg-slate-100"}),e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-4",children:A.title}),e.jsx("p",{className:"text-slate-700 whitespace-pre-line mb-6",children:A.caption}),e.jsxs("div",{className:"flex items-center justify-between border-t border-b border-slate-200 py-4 my-4",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx(m,{postId:A.id,initialLikeCount:Y.likeCount,initialIsLiked:Y.isLiked,onLikeToggle:(e,s,t)=>{E(e,s,t)},onLikesClick:Z,size:20,disabled:Y.isLoading}),e.jsxs("button",{onClick:ie,className:"flex items-center gap-2 text-slate-500 hover:text-blue-500 transition-colors",children:[e.jsx(N,{size:20}),e.jsx("span",{className:"font-medium",children:(null==(C=A.postComments)?void 0:C.length)||0})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"text-slate-500 hover:text-orange-500 transition-colors",children:e.jsx(v,{size:20})}),e.jsx("button",{className:"text-slate-500 hover:text-green-500 transition-colors",children:e.jsx(w,{size:20})})]})]}),z&&e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(i,{to:`/users/${z.id}`,className:"flex-shrink-0",children:e.jsx("img",{src:z.profileImage,alt:z.username,className:"w-10 h-10 rounded-full object-cover border-2 border-slate-200 hover:border-orange-500 transition-colors",onError:e=>{e.target.src="/default-avatar.png"}})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:J,onChange:e=>Q(e.target.value),placeholder:"Write a comment...",className:"w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 resize-none",rows:3}),e.jsx("button",{onClick:async()=>{if(z&&J.trim()){H(!0);try{const e={...(await x.createComment({comment:J.trim(),postId:A.id})).comment,commenter:{id:z.id,username:z.username,firstName:z.firstName||"",lastName:z.lastName||"",profileImage:z.profileImage||"/default-avatar.png"},replies:[]};A.postComments=[{id:e.id,userId:e.userId,postId:e.postId,comment:e.comment,username:z.username,parentId:e.parentId,created_at:e.createdAt,updated_at:e.updatedAt},...A.postComments],Q("")}catch(e){}finally{H(!1)}}},disabled:!J.trim()||G,className:"absolute bottom-3 right-3 p-2 bg-orange-500 text-white rounded-full hover:bg-orange-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:G?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(I,{size:16})})]})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold text-slate-900",children:["Comments (",(null==(k=A.postComments)?void 0:k.length)||0,")"]}),((null==(y=A.postComments)?void 0:y.length)||0)>3&&e.jsx("button",{onClick:ie,className:"text-orange-600 hover:text-orange-700 font-medium text-sm",children:"View all in modal"})]}),se.length>0?e.jsx("div",{className:"space-y-4",children:se.map(s=>e.jsx(c,{comment:s,depth:0,maxDepth:5,sessionUser:z,postUser:A.user,allComments:se,replyToComment:V,setReplyToComment:W,replyText:q,setReplyText:F,handleAddReply:ae,isSubmitting:G,formatTimeAgo:te,showAllReplies:K,toggleShowAllReplies:le},s.id))}):e.jsxs("div",{className:"text-center py-8 bg-slate-50 rounded-lg",children:[e.jsx(N,{size:32,className:"mx-auto text-slate-300 mb-2"}),e.jsx("p",{className:"text-slate-600 mb-3",children:"No comments yet. Be the first to comment!"})]})]})]})]})}),e.jsx(u,{isOpen:T.isOpen,onClose:D,postId:T.postId||A.id,initialComments:T.comments}),$&&_&&e.jsx(p,{isOpen:$,onClose:O,postId:_,initialCount:Y.likeCount})]});var ne};export{C as default};
