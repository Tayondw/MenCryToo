import{j as e}from"./index-fkdTXUqh.js";import{r as s}from"./react-vendor-DWDxyCYt.js";import{f as t,g as a,h as l,L as r,u as o}from"./router-vendor-DqRelNZw.js";import{a as i}from"./redux-vendor-s9F9CGgp.js";import{u as n,a as d,b as c,P as m}from"./CommentThread-8lV8dGCX.js";import{u as x,C as h}from"./CommentModal-Bo2mewch.js";import{V as u,a7 as g,x as p,U as b,c as f,T as j,w as v,z as N,B as w,a0 as k,r as C,s as y,a2 as z,u as P,a1 as L,R as M}from"./ui-vendor-LOG_mfyu.js";const I=()=>{var o,m,P,L,M,I,T;const $=t(),A=i(e=>e.session.user),[U,E]=a(),O=l(),{modal:F,openModal:D,closeModal:R}=x({forceRefreshOnClose:!0,refreshDelay:150}),{likeStates:Y,setLikeState:_,fetchLikeStatus:B}=n(),{isOpen:V,postId:q,openModal:G,closeModal:H}=d(),[J,K]=s.useState("grid"),[Q,W]=s.useState(""),[X,Z]=s.useState([]),[ee,se]=s.useState(!1),[te,ae]=s.useState(new Map),le=U.get("tab")||$.activeTab||"all",re=parseInt(U.get("page")||"1"),{activePosts:oe,activePagination:ie}=s.useMemo(()=>"similar"===le?{activePosts:$.similarPosts||[],activePagination:$.similarPostsPagination}:{activePosts:$.allPosts||[],activePagination:$.allPostsPagination},[le,$]);s.useEffect(()=>{oe.forEach(e=>{Y.has(e.id)||(_(e.id,!1,e.likes),B(e.id))})},[oe,Y,_,B]),s.useEffect(()=>{const e=new Map;oe.forEach(s=>{e.set(s.id,s.comments)}),ae(e)},[oe]);const ne=s.useMemo(()=>Q||0!==X.length?oe.filter(e=>!Q||(e.title.toLowerCase().includes(Q.toLowerCase())||e.caption.toLowerCase().includes(Q.toLowerCase())||e.user.username.toLowerCase().includes(Q.toLowerCase()))):oe,[oe,Q,X]),de=s.useCallback(e=>{const s=new Date,t=new Date(e),a=Math.floor((s.getTime()-t.getTime())/1e3);if(a<60)return"just now";const l=Math.floor(a/60);if(l<60)return`${l}m ago`;const r=Math.floor(l/60);if(r<24)return`${r}h ago`;const o=Math.floor(r/24);if(o<7)return`${o}d ago`;const i=Math.floor(o/7);if(i<4)return`${i}w ago`;const n=Math.floor(o/30);if(n<12)return`${n}mo ago`;return`${Math.floor(o/365)}y ago`},[]),ce=s.useCallback(e=>{const s=new URLSearchParams(U);s.set("tab",e),s.delete("page"),E(s)},[U,E]),me=s.useCallback(e=>{const s=new URLSearchParams(U);s.set("page",e.toString()),E(s),window.scrollTo({top:0,behavior:"smooth"})},[U,E]),xe=s.useCallback(()=>{se(!0),O.submit({intent:"refresh-feed"},{method:"post"}),setTimeout(()=>{se(!1)},1e3)},[O]),he=s.useCallback(e=>{G(e)},[G]),ue=s.useCallback(async(e,s)=>{let t=[];s.postComments&&s.postComments.length>0&&(t=s.postComments.map(e=>({id:e.id,userId:e.userId,postId:e.postId,comment:e.comment,parentId:e.parentId,createdAt:e.created_at,updatedAt:e.updated_at,commenter:e.commenter||{id:e.userId,username:e.username||"Unknown User",firstName:"",lastName:"",profileImage:"/default-avatar.png"},replies:[]}))),D(e,t,(e,s)=>{ae(t=>{const a=new Map(t);return a.set(e,s),a})})},[D]),ge=s.useCallback(()=>{W(""),Z([])},[]);return $.error?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-orange-50 to-slate-100 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-sm border border-red-200 max-w-md mx-auto text-center",children:[e.jsx(u,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-red-800 mb-2",children:"Error Loading Posts"}),e.jsx("p",{className:"text-red-600 mb-4",children:$.error}),e.jsxs("button",{onClick:xe,className:"inline-flex items-center gap-2 bg-orange-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-orange-600 transition-colors",disabled:ee,children:[e.jsx(g,{size:18,className:ee?"animate-spin":""}),"Try Again"]})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-orange-50 to-slate-100",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm border-b border-slate-200 sticky top-0 z-40",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("h1",{className:"text-xl font-bold text-slate-800",children:"Posts Feed"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[A&&e.jsxs(r,{to:"/posts/create",className:"inline-flex items-center gap-2 bg-gradient-to-r from-orange-500 to-slate-600 text-white px-4 py-2 rounded-lg font-medium hover:from-orange-600 hover:to-slate-700 transition-all duration-200 shadow-md hover:shadow-lg",children:[e.jsx(p,{size:18}),"Create Post"]}),e.jsx("button",{onClick:xe,className:"p-2 rounded-lg text-slate-600 hover:text-slate-900 hover:bg-slate-100 transition-colors "+(ee?"animate-spin":""),disabled:ee,children:e.jsx(g,{size:20})})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold bg-gradient-to-r from-orange-600 to-slate-800 bg-clip-text text-transparent mb-4",children:"Community Posts"}),e.jsx("p",{className:"text-lg text-slate-600 max-w-2xl mx-auto",children:"Discover posts from the community and connect with users who share your interests."})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-1 mb-8 flex",children:[e.jsxs("button",{onClick:()=>ce("all"),className:"flex-1 py-3 px-4 rounded-lg font-medium transition-colors "+("all"===le?"bg-orange-100 text-orange-700":"text-slate-600 hover:text-slate-900 hover:bg-slate-50"),children:["All Posts (",(null==(o=$.stats)?void 0:o.totalPosts)||0,")"]}),e.jsxs("button",{onClick:()=>ce("similar"),className:"flex-1 py-3 px-4 rounded-lg font-medium transition-colors "+("similar"===le?"bg-orange-100 text-orange-700":"text-slate-600 hover:text-slate-900 hover:bg-slate-50"),children:["Similar Users' Posts (",(null==(m=$.stats)?void 0:m.similarPosts)||0,")"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx(b,{size:24,className:"text-orange-600"})}),e.jsx("h3",{className:"text-2xl font-bold text-slate-900",children:"all"===le?(null==(P=$.stats)?void 0:P.totalPosts)||0:(null==(L=$.stats)?void 0:L.similarUsers)||0}),e.jsx("p",{className:"text-slate-600",children:"all"===le?"Total Posts":"Similar Users"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx(f,{size:24,className:"text-blue-600"})}),e.jsx("h3",{className:"text-2xl font-bold text-slate-900",children:"all"===le?"All":(null==(M=$.stats)?void 0:M.similarPosts)||0}),e.jsx("p",{className:"text-slate-600",children:"all"===le?"Community":"Similar Posts"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx(j,{size:24,className:"text-purple-600"})}),e.jsx("h3",{className:"text-2xl font-bold text-slate-900",children:(null==(I=$.stats)?void 0:I.userTags)||0}),e.jsx("p",{className:"text-slate-600",children:"Your Tags"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-8",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(v,{size:20,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search posts by title, content, or username...",value:Q,onChange:e=>W(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors"})]})}),e.jsxs("div",{className:"flex items-center gap-1 bg-slate-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>K("grid"),className:"p-2 rounded-md transition-colors "+("grid"===J?"bg-white shadow-sm text-orange-600":"text-slate-600 hover:text-slate-900"),children:e.jsx(N,{size:18})}),e.jsx("button",{onClick:()=>K("list"),className:"p-2 rounded-md transition-colors "+("list"===J?"bg-white shadow-sm text-orange-600":"text-slate-600 hover:text-slate-900"),children:e.jsx(w,{size:18})})]}),(Q||X.length>0)&&e.jsx("button",{onClick:ge,className:"px-4 py-2 text-orange-600 hover:text-orange-700 font-medium transition-colors",children:"Clear Filters"})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-slate-200",children:e.jsxs("p",{className:"text-sm text-slate-600",children:["Showing"," ",e.jsx("span",{className:"font-semibold",children:ne.length})," ","posts",Q&&` matching "${Q}"`,"similar"===le&&" from similar users"]})})]}),0===ne.length?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-24 h-24 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(k,{size:32,className:"text-slate-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-2",children:"No posts found"}),e.jsx("p",{className:"text-slate-600 mb-6 max-w-md mx-auto",children:Q?"Try adjusting your search terms to find more posts.":"similar"===le&&$.message?$.message:"No posts are currently available. Check back later!"}),A&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(r,{to:"/posts/create",className:"inline-flex items-center gap-2 bg-gradient-to-r from-orange-500 to-slate-600 text-white px-6 py-3 rounded-lg font-medium hover:from-orange-600 hover:to-slate-700 transition-all duration-200",children:[e.jsx(p,{size:20}),"Create First Post"]}),"similar"===le&&(!A.usersTags||0===A.usersTags.length)&&e.jsx("div",{className:"mt-4",children:e.jsxs(r,{to:`/users/${A.id}/profile/update`,className:"inline-flex items-center gap-2 bg-blue-500 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-600 transition-colors",children:[e.jsx(b,{size:20}),"Add Tags to Your Profile"]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid"===J?"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6":"space-y-6",children:ne.map(s=>{const t=te.get(s.id)??s.comments;return e.jsx(S,{post:s,viewMode:J,formatTimeAgo:de,handleCommentClick:ue,handleLikesClick:he,likeState:Y.get(s.id),setLikeState:_,sessionUser:A,currentCommentCount:t},s.id)})}),ie.pages>1&&e.jsx("div",{className:"flex justify-center mt-8",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>me(1),disabled:1===re,className:"px-3 py-1 rounded-md border border-slate-300 text-slate-700 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"First"}),e.jsx("button",{onClick:()=>me(re-1),disabled:1===re,className:"p-1 rounded-md border border-slate-300 text-slate-700 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(C,{size:18})}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,ie.pages)},(s,t)=>{let a;return a=ie.pages<=5||re<=3?t+1:re>=ie.pages-2?ie.pages-4+t:re-2+t,e.jsx("button",{onClick:()=>me(a),className:"w-8 h-8 flex items-center justify-center rounded-md "+(re===a?"bg-orange-500 text-white":"border border-slate-300 text-slate-700 hover:bg-slate-50"),children:a},a)})}),e.jsx("button",{onClick:()=>me(re+1),disabled:re===ie.pages,className:"p-1 rounded-md border border-slate-300 text-slate-700 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(y,{size:18})}),e.jsx("button",{onClick:()=>me(ie.pages),disabled:re===ie.pages,className:"px-3 py-1 rounded-md border border-slate-300 text-slate-700 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Last"})]})})]}),"similar"===le&&$.message&&0===ne.length&&e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4 mt-8 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-orange-600 mb-2",children:[e.jsx(z,{size:20}),e.jsx("h3",{className:"font-semibold",children:"Personalized Feed"})]}),e.jsx("p",{className:"text-orange-700",children:$.message}),e.jsxs(r,{to:`/users/${null==A?void 0:A.id}/profile/update`,className:"inline-flex items-center gap-2 bg-orange-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-orange-600 transition-colors mt-4",children:[e.jsx(b,{size:18}),"Add Tags to Profile"]})]})]}),e.jsx(h,{isOpen:F.isOpen,onClose:R,postId:F.postId||0,initialComments:F.comments,forceRefreshOnClose:!0,onCommentsChange:(e,s)=>{ae(t=>{const a=new Map(t);return a.set(e,s),a})}}),V&&q&&e.jsx(c,{isOpen:V,onClose:H,postId:q,initialCount:(null==(T=Y.get(q))?void 0:T.likeCount)||0})]})},S=({post:s,viewMode:t,formatTimeAgo:a,handleCommentClick:l,handleLikesClick:i,likeState:n,setLikeState:d,currentCommentCount:c})=>{const x=o(),h=s,u=()=>{l(s.id,h)},g=(t,a=3)=>{const l=49*a;if(t.length<=l)return e.jsx("span",{children:t});const r=t.substring(0,l),o=r.lastIndexOf(" "),i=o>0?r.substring(0,o):r;return e.jsxs("span",{children:[i,e.jsx("button",{onClick:e=>{e.preventDefault(),x(`/posts/${s.id}`)},className:"text-orange-600 hover:text-orange-700 font-medium ml-1 transition-colors duration-200",children:"...more"})]})};return e.jsx("div",{className:`bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden hover:shadow-lg hover:border-orange-300 transition-all duration-300 ${"list"===t?"p-6":""} ${"grid"===t?"h-full flex flex-col":""}`,children:"grid"===t?e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"relative",children:e.jsx("img",{src:s.image,alt:s.title,className:"w-full h-64 object-cover",loading:"lazy"})}),e.jsxs("div",{className:"p-6 flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(r,{to:`/users/${s.user.id}`,className:"flex-shrink-0",children:e.jsx("img",{src:s.user.profileImage,alt:s.user.username,className:"w-10 h-10 rounded-full object-cover border-2 border-slate-200",loading:"lazy",onError:e=>{e.target.src="/default-avatar.png"}})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx(r,{to:`/users/${s.user.id}`,className:"font-semibold text-slate-900 hover:text-orange-600 transition-colors block truncate",children:s.user.username}),e.jsxs("div",{className:"flex items-center text-xs text-slate-500",children:[e.jsx(P,{size:12,className:"mr-1"}),e.jsx("span",{children:a(s.createdAt)})]})]})]}),e.jsx(r,{to:`/posts/${s.id}`,className:"block group",children:e.jsx("h3",{className:"font-bold text-lg h-14 text-slate-900 group-hover:text-orange-600 transition-colors mb-3 line-clamp-2 tracking-widest",children:s.title})}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(m,{postId:s.id,initialLikeCount:(null==n?void 0:n.likeCount)||s.likes,initialIsLiked:(null==n?void 0:n.isLiked)||!1,onLikeToggle:(e,s,t)=>{d(e,s,t)},onLikesClick:i,size:18,disabled:null==n?void 0:n.isLoading}),e.jsxs("button",{onClick:u,className:"flex items-center gap-1 text-slate-500 hover:text-blue-500 transition-colors",children:[e.jsx(k,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:c})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"text-slate-400 hover:text-orange-500 transition-colors",children:e.jsx(L,{size:18})}),e.jsx("button",{className:"text-slate-400 hover:text-green-500 transition-colors",children:e.jsx(M,{size:18})})]})]}),e.jsx("div",{className:"mt-auto mb-4",children:e.jsx("div",{className:"flex h-10 items-start gap-2 text-slate-600 text-sm leading-relaxed",children:e.jsx("div",{className:"flex-1 min-w-0",children:g(s.caption)})})})]})]}):e.jsxs("div",{className:"flex gap-6",children:[e.jsx(r,{to:`/posts/${s.id}`,className:"flex-shrink-0 w-32 h-32 sm:w-48 sm:h-48 overflow-hidden rounded-lg",children:e.jsx("img",{src:s.image,alt:s.title,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-300",loading:"lazy"})}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(r,{to:`/users/${s.user.id}`,className:"flex-shrink-0",children:e.jsx("img",{src:s.user.profileImage,alt:s.user.username,className:"w-8 h-8 rounded-full object-cover border-2 border-slate-200",loading:"lazy",onError:e=>{e.target.src="/default-avatar.png"}})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx(r,{to:`/users/${s.user.id}`,className:"font-semibold text-slate-900 hover:text-orange-600 transition-colors block truncate",children:s.user.username}),e.jsxs("div",{className:"flex items-center text-xs text-slate-500",children:[e.jsx(P,{size:12,className:"mr-1"}),e.jsx("span",{children:a(s.createdAt)})]})]})]}),e.jsx(r,{to:`/posts/${s.id}`,className:"block group flex-1",children:e.jsx("h3",{className:"font-bold text-lg text-slate-900 group-hover:text-orange-600 transition-colors mb-2",children:s.title})}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(m,{postId:s.id,initialLikeCount:(null==n?void 0:n.likeCount)||s.likes,initialIsLiked:(null==n?void 0:n.isLiked)||!1,onLikeToggle:(e,s,t)=>{d(e,s,t)},onLikesClick:i,size:16,disabled:null==n?void 0:n.isLoading}),e.jsxs("button",{onClick:u,className:"flex items-center gap-1 text-slate-500 hover:text-blue-500 transition-colors",children:[e.jsx(k,{size:16}),e.jsx("span",{className:"text-sm font-medium",children:c})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"text-slate-400 hover:text-orange-500 transition-colors",children:e.jsx(L,{size:16})}),e.jsx("button",{className:"text-slate-400 hover:text-green-500 transition-colors",children:e.jsx(M,{size:16})})]})]}),e.jsx("div",{className:"mt-auto",children:e.jsx("div",{className:"flex items-start gap-2 text-slate-600 text-sm leading-relaxed",children:e.jsx("div",{className:"flex-1 min-w-0",children:g(s.caption)})})})]})]})})};export{I as default};
