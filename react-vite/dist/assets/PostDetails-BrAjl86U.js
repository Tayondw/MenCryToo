import{j as e}from"./index-D1HbfN_4.js";import{r as s}from"./react-vendor-DWDxyCYt.js";import{f as t,u as a,L as r}from"./router-vendor-DqRelNZw.js";import{a as i}from"./redux-vendor-s9F9CGgp.js";import{u as l,a as o,P as n,C as m,b as d,c}from"./CommentThread-d2zcaQG9.js";import{P as u}from"./PostMenu-JUX3m7UC.js";import{l as p,u as x,a0 as f,a1 as g,R as h,a5 as N}from"./ui-vendor-LOG_mfyu.js";const j=()=>{var j;const b=t(),v=i(e=>e.session.user),I=a(),{likeStates:w,setLikeState:y,fetchLikeStatus:k}=l(),{isOpen:C,postId:A,openModal:T,closeModal:S}=o(),[L,D]=s.useState((null==(j=b.postComments)?void 0:j.length)||0),[z,M]=s.useState(""),[E,R]=s.useState(null),[_,U]=s.useState(""),[$,P]=s.useState(!1),[B,O]=s.useState({}),[W,q]=s.useState(b.postComments||[]);s.useEffect(()=>{w.has(b.id)||(y(b.id,!1,b.likes),k(b.id))},[b.id,b.likes,w,y,k]);const F=s.useMemo(()=>w.get(b.id)||{isLiked:!1,likeCount:b.likes,isLoading:!1},[w,b.id,b.likes]),G=s.useCallback(()=>{T(b.id)},[T,b.id]),H=(null==v?void 0:v.id)===b.creator,J=s.useCallback(e=>{const s=new Map,t=[];return e.forEach(e=>{let t;t=e.commenter?{id:e.commenter.id,username:e.commenter.username,firstName:e.commenter.firstName||"",lastName:e.commenter.lastName||"",profileImage:e.commenter.profileImage||"/default-avatar.png"}:v&&e.userId===v.id?{id:v.id,username:v.username,firstName:v.firstName||"",lastName:v.lastName||"",profileImage:v.profileImage||"/default-avatar.png"}:e.userId===b.user.id?{id:b.user.id,username:b.user.username,firstName:b.user.firstName,lastName:b.user.lastName,profileImage:b.user.profileImage}:{id:e.userId,username:e.username||"Unknown User",firstName:"",lastName:"",profileImage:"/default-avatar.png"};const a={id:e.id,userId:e.userId,postId:e.postId,comment:e.comment,parentId:e.parentId,createdAt:e.created_at,updatedAt:e.updated_at,commenter:t,replies:[]};s.set(e.id,a)}),e.forEach(e=>{const a=s.get(e.id);if(null===e.parentId)t.push(a);else{const t=s.get(e.parentId);t&&(t.replies||(t.replies=[]),t.replies.push(a))}}),t.sort((e,s)=>new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime()),t.forEach(e=>{e.replies&&e.replies.sort((e,s)=>new Date(e.createdAt).getTime()-new Date(s.createdAt).getTime())}),t},[b.user.id,v,b.user.firstName,b.user.lastName,b.user.profileImage,b.user.username]),K=s.useMemo(()=>W&&W.length>0?J(W):[],[W,J]),Q=s.useCallback(e=>{const s=new Date,t=new Date(e),a=Math.floor((s.getTime()-t.getTime())/36e5);if(a<1)return"just now";if(a<24)return`${a}h ago`;const r=Math.floor(a/24);return r<7?`${r}d ago`:t.toLocaleDateString()},[]),V=async e=>{var s;if(v&&_.trim()){P(!0);try{const t=X(e),a=(null==(s=null==t?void 0:t.commenter)?void 0:s.username)||"",r=await c.createReply({comment:_.trim(),postId:b.id,parentId:e,replyToUsername:a}),i={id:r.comment.id,userId:v.id,postId:b.id,comment:_.trim(),username:v.username,parentId:e,created_at:r.comment.createdAt,updated_at:r.comment.updatedAt,commenter:{id:v.id,username:v.username,firstName:v.firstName||"",lastName:v.lastName||"",profileImage:v.profileImage||"/default-avatar.png"}};q(e=>[...e,i]),D(e=>e+1),U(""),R(null)}catch(t){}finally{P(!1)}}},X=e=>{for(const s of K){if(s.id===e)return s;if(s.replies)for(const t of s.replies)if(t.id===e)return t}return null},Y=async(e,s)=>{try{await c.updateComment(e,s),q(t=>t.map(t=>t.id===e?{...t,comment:s}:t))}catch(t){throw t}},Z=async e=>{try{await c.deleteComment(b.id,e),q(s=>{const t=s.filter(s=>s.id!==e&&s.parentId!==e);return D(t.length),t})}catch(s){throw s}},ee=s.useCallback(e=>{O(s=>({...s,[e]:!s[e]}))},[]);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-orange-50 to-slate-100",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm border-b border-slate-200 sticky top-0 z-40",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex items-center justify-between h-16",children:e.jsxs(r,{to:"/similar-feed",className:"inline-flex items-center gap-2 text-slate-600 hover:text-slate-900 font-medium transition-colors",children:[e.jsx(p,{size:20}),"Back to Posts"]})})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-slate-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(r,{to:`/users/${b.user.id}`,className:"flex-shrink-0",children:e.jsx("img",{src:b.user.profileImage,alt:b.user.username,className:"w-12 h-12 rounded-full object-cover border-2 border-slate-200 hover:border-orange-500 transition-colors",onError:e=>{e.target.src="/default-avatar.png"}})}),e.jsxs("div",{children:[e.jsx(r,{to:`/users/${b.user.id}`,className:"font-semibold text-slate-900 hover:text-orange-600 transition-colors",children:b.user.username}),e.jsxs("div",{className:"flex items-center text-sm text-slate-500",children:[e.jsx(x,{size:14,className:"mr-1"}),e.jsx("span",{children:(se=b.createdAt,new Date(se).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}))})]})]})]}),H&&e.jsx(u,{navigate:I,post:{id:b.id,title:b.title,caption:b.caption,image:b.image,likes:b.likes,creator:b.creator,comments:L,createdAt:b.createdAt,updatedAt:b.updatedAt,user:{id:b.user.id,username:b.user.username,firstName:b.user.firstName,lastName:b.user.lastName,email:"",bio:"",profileImage:b.user.profileImage,usersTags:[],posts:[],group:[],events:[],userComments:[],createdAt:"",updatedAt:""}}})]})}),e.jsx("img",{src:b.image,alt:b.title,className:"w-full h-auto max-h-[600px] object-contain bg-slate-100"}),e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-4",children:b.title}),e.jsx("p",{className:"text-slate-700 whitespace-pre-line mb-6",children:b.caption}),e.jsxs("div",{className:"flex items-center justify-between border-t border-b border-slate-200 py-4 my-4",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx(n,{postId:b.id,initialLikeCount:F.likeCount,initialIsLiked:F.isLiked,onLikeToggle:(e,s,t)=>{y(e,s,t)},onLikesClick:G,size:20,disabled:F.isLoading}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-500",children:[e.jsx(f,{size:20}),e.jsx("span",{className:"font-medium",children:L})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"text-slate-500 hover:text-orange-500 transition-colors",children:e.jsx(g,{size:20})}),e.jsx("button",{className:"text-slate-500 hover:text-green-500 transition-colors",children:e.jsx(h,{size:20})})]})]}),v&&e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(r,{to:`/users/${v.id}`,className:"flex-shrink-0",children:e.jsx("img",{src:v.profileImage,alt:v.username,className:"w-10 h-10 rounded-full object-cover border-2 border-slate-200 hover:border-orange-500 transition-colors",onError:e=>{e.target.src="/default-avatar.png"}})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:z,onChange:e=>M(e.target.value),placeholder:"Write a comment...",className:"w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 resize-none",rows:3}),e.jsx("button",{onClick:async()=>{if(v&&z.trim()){P(!0);try{const e=await c.createComment({comment:z.trim(),postId:b.id}),s={id:e.comment.id,userId:v.id,postId:b.id,comment:z.trim(),username:v.username,parentId:null,created_at:e.comment.createdAt,updated_at:e.comment.updatedAt,commenter:{id:v.id,username:v.username,firstName:v.firstName||"",lastName:v.lastName||"",profileImage:v.profileImage||"/default-avatar.png"}};q(e=>[s,...e]),D(e=>e+1),M("")}catch(e){}finally{P(!1)}}},disabled:!z.trim()||$,className:"absolute bottom-3 right-3 p-2 bg-orange-500 text-white rounded-full hover:bg-orange-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:$?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(N,{size:16})})]})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h2",{className:"text-xl font-semibold text-slate-900",children:["Comments (",L,")"]})}),K.length>0?e.jsx("div",{className:"space-y-4",children:K.map(s=>e.jsx(m,{comment:s,depth:0,maxDepth:5,sessionUser:v,postUser:b.user,allComments:K,replyToComment:E,setReplyToComment:R,replyText:_,setReplyText:U,handleAddReply:V,isSubmitting:$,formatTimeAgo:Q,showAllReplies:B,toggleShowAllReplies:ee,onEdit:Y,onDelete:Z},s.id))}):e.jsxs("div",{className:"text-center py-8 bg-slate-50 rounded-lg",children:[e.jsx(f,{size:32,className:"mx-auto text-slate-300 mb-2"}),e.jsx("p",{className:"text-slate-600 mb-3",children:"No comments yet. Be the first to comment!"})]})]})]})]})}),C&&A&&e.jsx(d,{isOpen:C,onClose:S,postId:A,initialCount:F.likeCount})]});var se};export{j as default};
