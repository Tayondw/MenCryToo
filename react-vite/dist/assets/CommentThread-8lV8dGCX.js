var e=Object.defineProperty,t=(t,s,a)=>((t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a)(t,"symbol"!=typeof s?s+"":s,a);import{r as s}from"./react-vendor-DWDxyCYt.js";import{j as a}from"./index-fkdTXUqh.js";import{e as n,X as r,a8 as l,c as i,aa as o,a5 as c,a6 as d,a3 as m,I as u,n as p,ab as h,f as x,s as g,a0 as f}from"./ui-vendor-LOG_mfyu.js";import{L as b}from"./router-vendor-DqRelNZw.js";const y=()=>{const[e,t]=s.useState(new Map),a=s.useCallback((e,s,a)=>{t(t=>{const n=new Map(t);return n.set(e,{isLiked:s,likeCount:a,isLoading:!1}),n})},[]),n=s.useCallback(t=>e.get(t)||null,[e]),r=s.useCallback(async e=>{try{const t=await fetch(`/api/posts/${e}/like-status`);if(t.ok){const s=await t.json();a(e,s.isLiked,s.likeCount)}}catch(t){}},[a]),l=s.useCallback(async(e,s,a)=>{t(t=>{const n=new Map(t);return n.set(e,{isLiked:s,likeCount:a,isLoading:!0}),n});const n=!s,r=n?a+1:a-1;t(t=>{const s=new Map(t);return s.set(e,{isLiked:n,likeCount:r,isLoading:!0}),s});try{const s=await fetch(`/api/posts/${e}/like`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error("Failed to toggle like");const a=await s.json();t(t=>{const s=new Map(t);return s.set(e,{isLiked:a.isLiked,likeCount:a.likeCount,isLoading:!1}),s})}catch(l){throw t(t=>{const n=new Map(t);return n.set(e,{isLiked:s,likeCount:a,isLoading:!1}),n}),l}},[]);return{likeStates:e,toggleLike:l,setLikeState:a,getLikeState:n,fetchLikeStatus:r}},j=()=>{const[e,t]=s.useState(!1),[a,n]=s.useState(null);return{isOpen:e,postId:a,openModal:s.useCallback(e=>{n(e),t(!0)},[]),closeModal:s.useCallback(()=>{t(!1),setTimeout(()=>{n(null)},300)},[])}};class v extends Error{constructor(e,t,s){super(e),this.statusCode=t,this.errors=s,this.name="CommentApiError"}}const w=new class{constructor(){t(this,"baseUrl","/api/comments")}async handleResponse(e){if(!e.ok){let t,s=`HTTP ${e.status}: ${e.statusText}`;try{const a=await e.json();a.errors?(t=a.errors,s=a.message||s):a.message&&(s=a.message)}catch{}throw new v(s,e.status,t)}try{return await e.json()}catch{throw new v("Failed to parse response JSON")}}async getPostComments(e,t={}){const{page:s=1,perPage:a=20,includeReplies:n=!0,includeLikes:r=!1}=t,l=new URLSearchParams({page:s.toString(),per_page:a.toString(),include_replies:n.toString(),include_likes:r.toString()}),i=await fetch(`${this.baseUrl}/posts/${e}/comments?${l}`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});return this.handleResponse(i)}async getComment(e){const t=await fetch(`${this.baseUrl}/${e}`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});return await this.handleResponse(t)}async getCommentReplies(e,t={}){const{page:s=1,perPage:a=10}=t,n=new URLSearchParams({page:s.toString(),per_page:a.toString()}),r=await fetch(`${this.baseUrl}/${e}/replies?${n}`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});return this.handleResponse(r)}async createComment(e){const t=new FormData;t.append("comment",e.comment),e.parentId&&t.append("parent_id",e.parentId.toString());const s=await fetch(`${this.baseUrl}/posts/${e.postId}/comments`,{method:"POST",body:t,credentials:"include"});return this.handleResponse(s)}async createReply(e){if(!e.parentId)throw new v("Parent ID is required for replies");const t=new FormData;t.append("comment",e.comment),t.append("parent_id",e.parentId.toString());const s=await fetch(`${this.baseUrl}/posts/${e.postId}/comments`,{method:"POST",body:t,credentials:"include"});return this.handleResponse(s)}async updateComment(e,t){const s=await fetch(`${this.baseUrl}/${e}/edit`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({comment:t}),credentials:"include"});return this.handleResponse(s)}async deleteComment(e,t){const s=await fetch(`${this.baseUrl}/posts/${e}/comments/${t}`,{method:"DELETE",credentials:"include"});return this.handleResponse(s)}async toggleCommentLike(e){const t=await fetch(`${this.baseUrl}/${e}/like`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});return this.handleResponse(t)}async getCommentLikeStatus(e){const t=await fetch(`${this.baseUrl}/${e}/like-status`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});return this.handleResponse(t)}async getCommentLikes(e){const t=await fetch(`${this.baseUrl}/${e}/likes`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});return this.handleResponse(t)}async getBatchCommentLikeStatus(e){const t=await fetch(`${this.baseUrl}/batch-like-status`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({commentIds:e}),credentials:"include"});return this.handleResponse(t)}async getRecentComments(e={}){const{page:t=1,perPage:s=20}=e,a=new URLSearchParams({page:t.toString(),per_page:s.toString()}),n=await fetch(`${this.baseUrl}/recent?${a}`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});return this.handleResponse(n)}validateComment(e){const t=e.trim();return t?t.length<1?{isValid:!1,error:"Comment is too short"}:t.length>500?{isValid:!1,error:"Comment is too long (max 500 characters)"}:{isValid:!0}:{isValid:!1,error:"Comment cannot be empty"}}formatCommentForDisplay(e){return{...e,commenter:{...e.commenter,profileImage:e.commenter.profileImage||"/default-avatar.png"},replies:e.replies||[],likes:e.likes||0,isLiked:e.isLiked||!1}}buildCommentTree(e){const t=new Map,s=[];e.forEach(e=>{const s=this.formatCommentForDisplay(e);t.set(e.id,s)}),e.forEach(e=>{const a=t.get(e.id);if(null===e.parentId||void 0===e.parentId)s.push(a);else{const n=t.get(e.parentId);n?(n.replies=n.replies||[],n.replies.push(a)):s.push(a)}}),s.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime());const a=e=>{e.replies&&e.replies.length>0&&(e.replies.sort((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()),e.replies.forEach(a))};return s.forEach(a),s}},k=({size:e=24,className:t="",color:s="currentColor"})=>a.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:s,className:t,xmlns:"http://www.w3.org/2000/svg",children:a.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z",fill:s})}),N=({postId:e,initialLikeCount:t,initialIsLiked:r=!1,onLikeToggle:l,onLikesClick:i,className:o="",showCount:c=!0,size:d=18,disabled:m=!1})=>{const[u,p]=s.useState(r),[h,x]=s.useState(t),[g,f]=s.useState(!1);s.useEffect(()=>{p(r),x(t)},[r,t]);return a.jsxs("div",{className:`flex items-center gap-2 ${o}`,children:[a.jsx("button",{onClick:async()=>{if(m||g)return;const t=!u,s=t?h+1:h-1;p(t),x(s),f(!0);try{const t=await fetch(`/api/posts/${e}/like`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to toggle like");const s=await t.json();p(s.isLiked),x(s.likeCount),l&&l(e,s.isLiked,s.likeCount)}catch(a){p(u),x(h)}finally{f(!1)}},disabled:m||g,className:`flex items-center gap-1 transition-all duration-200 ${u?"text-red-500 hover:text-red-600":"text-slate-500 hover:text-red-500"} ${m||g?"opacity-50 cursor-not-allowed":"cursor-pointer"} ${g?"animate-pulse":""} group`,"aria-label":u?"Unlike post":"Like post",children:u?a.jsx(k,{size:d,className:"transition-transform group-hover:scale-110"}):a.jsx(n,{size:d,className:"transition-transform group-hover:scale-110"})}),c&&a.jsx("button",{onClick:()=>{i&&h>0&&i(e)},className:"text-sm font-medium transition-colors "+(h>0?"text-slate-700 hover:text-orange-600 cursor-pointer":"text-slate-500 cursor-default"),disabled:0===h,"aria-label":`${h} likes`,children:h.toLocaleString()})]})},C=({isOpen:e,onClose:t,postId:o})=>{const[c,d]=s.useState([]),[m,u]=s.useState(!1),[p,h]=s.useState(null),x=s.useCallback(async()=>{u(!0),h(null);try{const e=await fetch(`/api/posts/${o}/likes`);if(!e.ok)throw new Error("Failed to fetch likes");const t=await e.json();d(t.likes||[])}catch(e){h("Failed to load likes. Please try again.")}finally{u(!1)}},[o]);s.useEffect(()=>{e&&o&&x()},[e,o,x]);return s.useEffect(()=>{const s=e=>{"Escape"===e.key&&t()};return e&&(document.addEventListener("keydown",s),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",s),document.body.style.overflow="unset"}},[e,t]),e?a.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:e=>{e.target===e.currentTarget&&t()},children:a.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-slate-200 w-full max-w-md max-h-[70vh] flex flex-col",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:a.jsx(n,{size:20,className:"text-red-500"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Likes"}),a.jsx("p",{className:"text-sm text-slate-600",children:m?"Loading...":`${c.length} ${1===c.length?"person":"people"} liked this post`})]})]}),a.jsx("button",{onClick:t,className:"p-2 rounded-lg text-slate-500 hover:text-slate-700 hover:bg-slate-100 transition-colors",children:a.jsx(r,{size:20})})]}),a.jsx("div",{className:"flex-1 overflow-y-auto",children:m?a.jsx("div",{className:"flex items-center justify-center py-12",children:a.jsx(l,{size:24,className:"animate-spin text-orange-500"})}):p?a.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-6 text-center",children:[a.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:a.jsx(n,{size:24,className:"text-red-500"})}),a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Oops! Something went wrong"}),a.jsx("p",{className:"text-slate-600 mb-4",children:p}),a.jsx("button",{onClick:x,className:"px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors",children:"Try Again"})]}):0===c.length?a.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-6 text-center",children:[a.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mb-4",children:a.jsx(i,{size:24,className:"text-slate-400"})}),a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"No likes yet"}),a.jsx("p",{className:"text-slate-600",children:"Be the first to show some love for this post!"})]}):a.jsx("div",{className:"px-6 py-4",children:a.jsx("div",{className:"space-y-3",children:c.map(e=>a.jsxs(b,{to:`/users/${e.id}`,onClick:t,className:"flex items-center gap-3 p-3 rounded-lg hover:bg-slate-50 transition-colors group",children:[a.jsx("img",{src:e.profileImage,alt:e.username,className:"w-12 h-12 rounded-full object-cover border-2 border-slate-200 group-hover:border-orange-500 transition-colors",onError:e=>{e.target.src="/default-avatar.png"}}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"font-semibold text-slate-900 group-hover:text-orange-600 transition-colors truncate",children:e.username}),a.jsxs("div",{className:"text-sm text-slate-600 truncate",children:[e.firstName," ",e.lastName]})]}),a.jsx("div",{className:"text-red-500 opacity-60 group-hover:opacity-100 transition-opacity",children:a.jsx(n,{size:16,fill:"currentColor"})})]},e.id))})})}),c.length>0&&!m&&a.jsx("div",{className:"p-6 border-t border-slate-200 bg-slate-50",children:a.jsx("div",{className:"text-center",children:a.jsx("p",{className:"text-sm text-slate-600",children:1===c.length?"1 person likes this post":`${c.length} people like this post`})})})]})}):null};function $(e,t){const s=t.toLowerCase().trim();if(!s)return e;const a=e=>{var t;const n=(e=>{const t=e.comment.toLowerCase().includes(s),a=e.commenter.username.toLowerCase().includes(s),n=e.commenter.firstName.toLowerCase().includes(s),r=e.commenter.lastName.toLowerCase().includes(s);return t||a||n||r})(e),r=(null==(t=e.replies)?void 0:t.map(a).filter(Boolean))||[];return n||r.length>0?{...e,replies:r}:null};return e.map(a).filter(Boolean)}const L=({postId:e,parentId:t=null,replyToUsername:n,onSubmit:l,onCancel:i,placeholder:d="Write a comment...",autoFocus:m=!1,isSubmitting:u=!1})=>{const[p,h]=s.useState(""),[x,g]=s.useState(null),f=s.useRef(null);s.useEffect(()=>{m&&f.current&&f.current.focus()},[m]),s.useEffect(()=>{f.current&&(f.current.style.height="auto",f.current.style.height=`${f.current.scrollHeight}px`)},[p]);const b=async s=>{s.preventDefault(),g(null);const a=function(e){const t=e.trim();return t?t.length<1?{isValid:!1,error:"Comment is too short"}:t.length>500?{isValid:!1,error:"Comment is too long (max 500 characters)"}:{isValid:!0}:{isValid:!1,error:"Comment cannot be empty"}}(p);if(a.isValid)try{await l({comment:p.trim(),postId:e,parentId:t,replyToUsername:n}),h(""),g(null)}catch(r){g(r instanceof Error?r.message:"Failed to post comment")}else g(a.error||"Invalid comment")},y=null!==t&&n,j=y?"Reply":"Comment",v=p.length,w=v>400,k=v>500;return a.jsxs("form",{onSubmit:b,className:"space-y-3",children:[y&&a.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 bg-gray-50 px-3 py-2 rounded-lg",children:[a.jsx(o,{size:14}),a.jsxs("span",{children:["Replying to ",a.jsxs("span",{className:"font-medium",children:["@",n]})]}),i&&a.jsx("button",{type:"button",onClick:i,className:"ml-auto text-gray-400 hover:text-gray-600 transition-colors",children:a.jsx(r,{size:14})})]}),a.jsxs("div",{className:"relative",children:[a.jsx("textarea",{ref:f,value:p,onChange:e=>{h(e.target.value),x&&g(null)},onKeyDown:e=>{"Enter"===e.key&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),b(e)),"Escape"===e.key&&i&&(e.preventDefault(),i())},placeholder:d,disabled:u,className:`\n            w-full px-4 py-3 pr-12 border rounded-lg resize-none transition-all duration-200\n            min-h-[80px] max-h-[200px]\n            ${x?"border-red-300 focus:border-red-500 focus:ring-red-200":"border-gray-300 focus:border-orange-500 focus:ring-orange-200"}\n            ${u?"bg-gray-50 cursor-not-allowed":"bg-white"}\n            focus:ring-2 focus:outline-none\n          `,rows:3}),a.jsx("button",{type:"submit",disabled:!p.trim()||u||k,className:`\n            absolute bottom-3 right-3 p-2 rounded-full transition-all duration-200\n            ${!p.trim()||k||u?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-orange-500 text-white hover:bg-orange-600 shadow-md hover:shadow-lg"}\n          `,title:`${j} (⌘+Enter)`,children:u?a.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):a.jsx(c,{size:16})})]}),a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsx("div",{className:"flex-1",children:x&&a.jsx("span",{className:"text-red-600 font-medium",children:x})}),a.jsxs("div",{className:`\n          font-medium transition-colors\n          ${k?"text-red-600":w?"text-orange-600":"text-gray-400"}\n        `,children:[v,"/",500]})]}),y&&a.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[i&&a.jsx("button",{type:"button",onClick:i,disabled:u,className:"px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800 transition-colors disabled:opacity-50",children:"Cancel"}),a.jsx("button",{type:"submit",disabled:!p.trim()||u||k,className:`\n              px-4 py-2 text-sm font-medium rounded-lg transition-all duration-200\n              ${!p.trim()||k||u?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-orange-500 text-white hover:bg-orange-600 shadow-md hover:shadow-lg"}\n            `,children:u?"Posting...":j})]}),a.jsxs("div",{className:"text-xs text-gray-400 text-right",children:[a.jsx("span",{children:"⌘+Enter to post"}),i&&a.jsx("span",{children:" • Esc to cancel"})]})]})},S=({commentId:e,initialLikeCount:t,initialIsLiked:r=!1,onLikeToggle:l,onLikesClick:i,className:o="",showCount:c=!0,size:d=14,disabled:m=!1})=>{const[u,p]=s.useState(r),[h,x]=s.useState(t),[g,f]=s.useState(!1);s.useEffect(()=>{p(r),x(t)},[r,t,e]),s.useEffect(()=>{0!==t||r||(async()=>{try{const t=await fetch(`/api/comments/${e}/like-status`,{credentials:"include"});if(t.ok){const e=await t.json();p(e.isLiked),x(e.likeCount)}}catch(t){}})()},[e,t,r]);const b=s.useCallback(async()=>{if(m||g)return;const t=!u,s=t?h+1:Math.max(0,h-1);p(t),x(s),f(!0);try{const t=await fetch(`/api/comments/${e}/like`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const s=await t.json();s.success?(p(s.isLiked),x(s.likeCount),l&&l(e,s.isLiked,s.likeCount)):(p(u),x(h))}catch(a){p(u),x(h)}finally{f(!1)}},[e,m,g,u,h,l]),y=s.useCallback(t=>{t.stopPropagation(),i&&h>0&&i(e)},[i,e,h]),j=s.useCallback(e=>{e.stopPropagation(),b()},[b]);return a.jsxs("div",{className:`flex items-center gap-1 ${o}`,children:[a.jsx("button",{onClick:j,disabled:m||g,className:`flex items-center transition-all duration-200 ${u?"text-red-500 hover:text-red-600":"text-slate-400 hover:text-red-500"} ${m||g?"opacity-50 cursor-not-allowed":"cursor-pointer"} ${g?"animate-pulse":""} group`,"aria-label":u?"Unlike comment":"Like comment",title:u?"Unlike comment":"Like comment",children:u?a.jsx(k,{size:d,className:"transition-transform group-hover:scale-110",color:"currentColor"}):a.jsx(n,{size:d,className:"transition-transform group-hover:scale-110",fill:"none"})}),(c||h>0)&&h>0&&a.jsx("button",{onClick:y,className:"text-xs font-medium transition-colors text-slate-600 hover:text-red-500 cursor-pointer",disabled:0===h,"aria-label":`${h} likes`,title:`${h} ${1===h?"like":"likes"}`,children:h.toLocaleString()}),g&&a.jsx("div",{className:"w-3 h-3 border border-red-300 border-t-red-500 rounded-full animate-spin ml-1"})]})},T=({comment:e,depth:t=0,maxDepth:n=5,sessionUser:l,postUser:i,allComments:c=[],replyToComment:y,setReplyToComment:j,replyText:v="",setReplyText:w,isSubmitting:k=!1,showAllReplies:N={},toggleShowAllReplies:C,onReply:$,onEdit:E,onDelete:z,handleAddReply:I,onLikeToggle:R,onShowLikes:U,formatTimeAgo:D,currentUserId:P})=>{var F,A,M,O,V,K,_,G,B,H;const[J,Y]=s.useState(!1),[q,W]=s.useState(!1),[Q,X]=s.useState(e.comment),[Z,ee]=s.useState(!0),[te,se]=s.useState(!1),[ae,ne]=s.useState(!1),[re,le]=s.useState(!1),[ie,oe]=s.useState(e.likes||0),[ce,de]=s.useState(e.isLiked||!1),me=!!(l&&j&&I),ue=P||(null==l?void 0:l.id),pe=function(e,t){return void 0!==t&&e.userId===t}(e,ue),he=e.replies&&e.replies.length>0,xe=t<n,ge=function(e){const t=e.match(/^@(\w+)/);return t?t[1]:null}(e.comment),fe=me?0:2,be=e.replies&&e.replies.length>fe,ye=(null==N?void 0:N[e.id])??ae,je=ye?e.replies:null==(F=e.replies)?void 0:F.slice(0,fe);s.useEffect(()=>{X(e.comment)},[e.comment]),s.useEffect(()=>{void 0!==e.likes&&oe(e.likes),void 0!==e.isLiked&&de(e.isLiked)},[e.likes,e.isLiked,e.id]);const ve=s.useCallback(e=>{if(0===e)return"";switch(e){case 1:return"ml-12";case 2:return"ml-16";case 3:return"ml-20";default:return"ml-24"}},[]),we=s.useMemo(()=>e.commenter?{id:e.commenter.id,username:e.commenter.username||"Unknown User",firstName:e.commenter.firstName||"",lastName:e.commenter.lastName||"",profileImage:e.commenter.profileImage||"/default-avatar.png"}:{id:e.userId,username:"Unknown User",firstName:"",lastName:"",profileImage:"/default-avatar.png"},[e.commenter,e.userId]),ke=s.useCallback(e=>{if(!me||!i||!c.length){const t=/@([\w-]+)/g;return e.split(t).map((e,t)=>t%2==1?a.jsxs("span",{className:"text-orange-600 font-medium",children:["@",e]},t):e)}const t=/@([\w-]+)/g,s=[];let n,r=0;for(;null!==(n=t.exec(e));){n.index>r&&s.push(e.slice(r,n.index));const t=n[1];let o=null;if(l&&t===l.username)o=l.id;else if(t===i.username)o=i.id;else{const e=s=>{var a;for(const n of s){if((null==(a=n.commenter)?void 0:a.username)===t)return n.commenter.id;if(n.replies){const t=e(n.replies);if(t)return t}}return null};o=e(c)}s.push(a.jsxs(b,{to:`/users/${o||t}`,className:"text-orange-600 hover:text-orange-700 font-medium",children:["@",t]},`mention-${n.index}`)),r=n.index+n[0].length}return r<e.length&&s.push(e.slice(r)),0===s.length?e:s},[me,i,c,l]),Ne=s.useCallback(async()=>{if(Q.trim()!==e.comment){if(Q.trim()){le(!0);try{await(null==E?void 0:E(e.id,Q.trim())),W(!1),se(!1)}catch(t){X(e.comment)}finally{le(!1)}}}else W(!1)},[e.comment,e.id,Q,E]),Ce=async()=>{if(window.confirm("Are you sure you want to delete this comment?"))try{await(null==z?void 0:z(e.id)),se(!1)}catch(t){}},$e=s.useCallback(async(t,s,a)=>{t===e.id&&void 0!==s&&void 0!==a&&(de(s),oe(a),R&&R(t,s,a))},[e.id,R]),Le=s.useCallback(e=>{U&&U(e)},[U]),Se=()=>{C?C(e.id):ne(!ae)},Te=()=>D?D(e.createdAt):function(e){const t=new Date,s=new Date(e),a=Math.floor((t.getTime()-s.getTime())/1e3);if(a<10)return"just now";if(a<60)return`${a}s ago`;const n=Math.floor(a/60);if(n<60)return`${n}m ago`;const r=Math.floor(n/60);if(r<24)return`${r}h ago`;const l=Math.floor(r/24);if(l<7)return`${l}d ago`;const i=Math.floor(l/7);return i<4?`${i}w ago`:s.toLocaleDateString("en-US",{month:"short",day:"numeric",year:s.getFullYear()!==t.getFullYear()?"numeric":void 0})}(e.createdAt),Ee=s.useCallback(()=>{W(!0),se(!1),X(e.comment)},[e.comment]),ze=s.useCallback(()=>{W(!1),X(e.comment)},[e.comment]),Ie=s.useCallback(e=>{"Enter"===e.key&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),Ne()),"Escape"===e.key&&(e.preventDefault(),ze())},[Ne,ze]);return a.jsx("div",{className:"space-y-3",children:a.jsxs("div",{className:`flex gap-3 ${t>0?ve(t):""} ${me?"":"group"}`,children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx(b,{to:`/users/${we.id}`,children:a.jsx("img",{src:we.profileImage,alt:we.username,className:"w-10 h-10 rounded-full object-cover border-2 border-slate-200 hover:border-orange-500 transition-colors",onError:e=>{const t=e.target;"/default-avatar.png"!==t.src&&(t.src="/default-avatar.png")}})})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[me?a.jsxs("div",{className:"bg-slate-50 rounded-lg p-3 relative group",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(b,{to:`/users/${we.id}`,className:"font-semibold text-slate-900 text-sm hover:text-orange-600 transition-colors",children:we.firstName&&we.lastName?`${we.firstName} ${we.lastName}`:we.username}),a.jsx("span",{className:"text-xs text-slate-500",children:Te()}),pe&&a.jsxs("div",{className:"relative ml-auto opacity-0 group-hover:opacity-100 transition-opacity",children:[a.jsx("button",{onClick:()=>se(!te),className:"p-1 hover:bg-slate-200 rounded-full transition-colors","aria-label":"Comment options",children:a.jsx(d,{size:14})}),te&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>se(!1)}),a.jsxs("div",{className:"absolute right-0 top-6 bg-white border border-gray-200 rounded-lg shadow-lg py-1 z-20 min-w-[120px]",children:[a.jsxs("button",{onClick:Ee,className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[a.jsx(m,{size:14}),"Edit"]}),a.jsxs("button",{onClick:Ce,className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-red-600 hover:bg-red-50",children:[a.jsx(u,{size:14}),"Delete"]})]})]})]})]}),q?a.jsxs("div",{className:"space-y-2 mb-2",children:[a.jsx("textarea",{value:Q,onChange:e=>X(e.target.value),onKeyDown:Ie,className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 resize-none text-sm",rows:2,autoFocus:!0,disabled:re}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{onClick:Ne,disabled:!Q.trim()||re,className:"inline-flex items-center gap-1 px-3 py-1 bg-orange-500 text-white text-sm rounded-lg hover:bg-orange-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:[re?a.jsx("div",{className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"}):a.jsx(p,{size:12}),re?"Saving...":"Save"]}),a.jsxs("button",{onClick:ze,disabled:re,className:"inline-flex items-center gap-1 px-3 py-1 text-gray-600 text-sm hover:text-gray-800 disabled:opacity-50",children:[a.jsx(r,{size:12}),"Cancel"]})]}),a.jsx("div",{className:"text-xs text-gray-400",children:"⌘+Enter to save • Esc to cancel"})]}):a.jsx("div",{className:"text-slate-700 text-sm mb-2",children:ke(e.comment)}),!q&&a.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:[l&&a.jsx(S,{commentId:e.id,initialLikeCount:ie,initialIsLiked:ce,onLikeToggle:$e,onLikesClick:Le,size:12,showCount:!0}),l&&a.jsxs("button",{onClick:()=>{j&&w&&(j(e.id),v.includes(`@${we.username}`)||w(`@${we.username} `))},className:"flex items-center gap-1 hover:text-orange-600 transition-colors",children:[a.jsx(h,{size:12}),"Reply"]}),he&&a.jsxs("button",{onClick:()=>ee(!Z),className:"flex items-center gap-1 hover:text-blue-500 transition-colors",children:[Z?a.jsx(x,{size:12}):a.jsx(g,{size:12}),null==(A=e.replies)?void 0:A.length," ",1===(null==(M=e.replies)?void 0:M.length)?"reply":"replies"]})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsxs("span",{className:"font-semibold text-gray-900 text-sm",children:[we.firstName," ",we.lastName]}),a.jsxs("span",{className:"text-gray-500 text-sm",children:["@",we.username]}),a.jsx("span",{className:"text-gray-400 text-xs",children:Te()}),pe&&a.jsxs("div",{className:"relative ml-auto opacity-0 group-hover:opacity-100 transition-opacity",children:[a.jsx("button",{onClick:()=>se(!te),className:"p-1 hover:bg-gray-100 rounded-full transition-colors",children:a.jsx(d,{size:14})}),te&&a.jsxs("div",{className:"absolute right-0 top-6 bg-white border border-gray-200 rounded-lg shadow-lg py-1 z-10 min-w-[120px]",children:[a.jsxs("button",{onClick:Ee,className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[a.jsx(m,{size:14}),"Edit"]}),a.jsxs("button",{onClick:Ce,className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-red-600 hover:bg-red-50",children:[a.jsx(u,{size:14}),"Delete"]})]})]})]}),a.jsx("div",{className:"mb-2",children:q?a.jsxs("div",{className:"space-y-2",children:[a.jsx("textarea",{value:Q,onChange:e=>X(e.target.value),onKeyDown:Ie,className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 resize-none",rows:2,autoFocus:!0,disabled:re}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:Ne,disabled:!Q.trim()||re,className:"px-3 py-1 bg-orange-500 text-white text-sm rounded-lg hover:bg-orange-600 disabled:bg-gray-300",children:re?"Saving...":"Save"}),a.jsx("button",{onClick:ze,disabled:re,className:"px-3 py-1 text-gray-600 text-sm hover:text-gray-800",children:"Cancel"})]})]}):a.jsxs("div",{className:"text-gray-800 text-sm leading-relaxed",children:[ge&&a.jsxs("span",{className:"inline-flex items-center gap-1 text-orange-600 font-medium mr-1",children:[a.jsx(o,{size:12}),ge]}),a.jsx("span",{children:ge?e.comment.replace(`@${ge}`,"").trim():e.comment})]})})]}),!q&&!me&&a.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:[l&&a.jsx(S,{commentId:e.id,initialLikeCount:ie,initialIsLiked:ce,onLikeToggle:$e,onLikesClick:Le,size:12,showCount:!0}),l&&a.jsxs("button",{onClick:()=>Y(!0),className:"flex items-center gap-1 hover:text-orange-600 transition-colors",children:[a.jsx(h,{size:12}),"Reply"]}),he&&a.jsxs("button",{onClick:()=>ee(!Z),className:"flex items-center gap-1 hover:text-blue-500 transition-colors",children:[Z?a.jsx(x,{size:12}):a.jsx(g,{size:12}),null==(O=e.replies)?void 0:O.length," ",1===(null==(V=e.replies)?void 0:V.length)?"reply":"replies"]})]}),J&&!me&&a.jsx("div",{className:"mt-3",children:a.jsx(L,{postId:e.postId,parentId:e.id,replyToUsername:null==(K=e.commenter)?void 0:K.username,onSubmit:async()=>{var t;try{await(null==$?void 0:$(e.id,(null==(t=e.commenter)?void 0:t.username)||"")),Y(!1)}catch(s){throw s}},onCancel:()=>Y(!1),placeholder:`Reply to @${null==(_=e.commenter)?void 0:_.username}...`,autoFocus:!0})}),y===e.id&&me&&l&&w&&a.jsxs("div",{className:`flex gap-3 mt-3 ${ve(1)}`,children:[a.jsx(b,{to:`/users/${l.id}`,className:"flex-shrink-0",children:a.jsx("img",{src:l.profileImage||"/default-avatar.png",alt:l.username,className:"w-8 h-8 rounded-full object-cover border-2 border-slate-200 hover:border-orange-500 transition-colors",onError:e=>{const t=e.target;"/default-avatar.png"!==t.src&&(t.src="/default-avatar.png")}})}),a.jsx("div",{className:"flex-1",children:a.jsxs("div",{className:"relative",children:[a.jsx("textarea",{value:v,onChange:e=>w(e.target.value),placeholder:`Reply to @${we.username}...`,className:"w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 resize-none text-sm",rows:2,onFocus:()=>{v.includes(`@${we.username}`)||w(`@${we.username} `)}}),a.jsxs("div",{className:"flex items-center justify-between mt-2",children:[a.jsx("button",{onClick:()=>{j(null),w("")},className:"text-xs text-slate-500 hover:text-slate-700",children:"Cancel"}),a.jsx("button",{onClick:()=>{let t=v.trim();t.includes(`@${we.username}`)||(t=`@${we.username} ${t}`),w(t),null==I||I(e.id)},disabled:!v.trim()||k,className:"px-3 py-1 bg-orange-500 text-white text-xs rounded-lg hover:bg-orange-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:k?"Posting...":"Reply"})]})]})})]}),he&&(Z||me)&&xe&&a.jsxs("div",{className:"mt-3 space-y-3",children:[null==je?void 0:je.map(e=>a.jsx(T,{comment:e,depth:t+1,maxDepth:n,sessionUser:l,postUser:i,allComments:c,replyToComment:y,setReplyToComment:j,replyText:v,setReplyText:w,isSubmitting:k,showAllReplies:N,toggleShowAllReplies:C,onReply:$,onEdit:E,onDelete:z,handleAddReply:I,onLikeToggle:R,onShowLikes:U,formatTimeAgo:D,currentUserId:P},e.id)),be&&a.jsx("div",{className:me?ve(t+1):"mt-2",children:ye?a.jsx("button",{onClick:Se,className:"text-sm text-slate-600 hover:text-slate-700 font-medium",children:"Show less"}):a.jsxs("button",{onClick:Se,className:"text-sm text-orange-600 hover:text-orange-700 font-medium",children:["View ",e.replies.length-fe," more replies"]})})]}),he&&(Z||me)&&!xe&&!me&&a.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg",children:[a.jsxs("div",{className:"text-xs text-gray-600 mb-2 flex items-center gap-1",children:[a.jsx(f,{size:12}),null==(G=e.replies)?void 0:G.length," more"," ",1===(null==(B=e.replies)?void 0:B.length)?"reply":"replies"]}),a.jsxs("div",{className:"space-y-2",children:[null==(H=e.replies)?void 0:H.slice(0,3).map(e=>{var t;return a.jsxs("div",{className:"text-sm",children:[a.jsxs("span",{className:"font-medium text-gray-900",children:["@",null==(t=e.commenter)?void 0:t.username]}),a.jsx("span",{className:"text-gray-700 ml-2",children:e.comment})]},e.id)}),e.replies&&e.replies.length>3&&a.jsxs("button",{className:"text-xs text-orange-600 hover:text-orange-700 font-medium",children:["View all ",e.replies.length," replies"]})]})]})]})]})})};export{T as C,N as P,j as a,C as b,w as c,$ as s,y as u};
