import{j as e}from"./index-BStRFqEB.js";import{r as s,c as t}from"./react-vendor-DWDxyCYt.js";import{e as a,f as l,g as r,L as i}from"./router-vendor-DFbjbkyO.js";import{a as o}from"./redux-vendor-s9F9CGgp.js";import{u as n,a as d,b as c,c as m,d as x,P as u}from"./useLikes-DoZGE7rK.js";import{V as h,a7 as g,w as p,U as b,c as f,T as j,v as N,y as v,z as w,a1 as k,q as C,r as y,a3 as I,t as z,a2 as L,Q as P}from"./ui-vendor-DzNpKoho.js";const S=()=>{var u,z,L,P,S,$,A;const M=a(),_=o(e=>e.session.user),[U,F]=l(),E=r(),{modal:O,openModal:D,closeModal:R}=n(),{likeStates:Y,setLikeState:q,fetchLikeStatus:Q}=d(),{isOpen:V,postId:B,openModal:G,closeModal:H}=c(),[J,K]=s.useState("grid"),[W,X]=s.useState(""),[Z,ee]=s.useState([]),[se,te]=s.useState(!1),ae=U.get("tab")||M.activeTab||"all",le=parseInt(U.get("page")||"1"),{activePosts:re,activePagination:ie}=s.useMemo(()=>"similar"===ae?{activePosts:M.similarPosts||[],activePagination:M.similarPostsPagination}:{activePosts:M.allPosts||[],activePagination:M.allPostsPagination},[ae,M]);t.useEffect(()=>{re.forEach(e=>{Y.has(e.id)||(q(e.id,!1,e.likes),Q(e.id))})},[re,Y,q,Q]);const oe=s.useMemo(()=>W||0!==Z.length?re.filter(e=>!W||(e.title.toLowerCase().includes(W.toLowerCase())||e.caption.toLowerCase().includes(W.toLowerCase())||e.user.username.toLowerCase().includes(W.toLowerCase()))):re,[re,W,Z]),ne=s.useCallback(e=>{const s=new Date,t=new Date(e),a=Math.floor((s.getTime()-t.getTime())/1e3);if(a<60)return"just now";const l=Math.floor(a/60);if(l<60)return`${l}m ago`;const r=Math.floor(l/60);if(r<24)return`${r}h ago`;const i=Math.floor(r/24);if(i<7)return`${i}d ago`;const o=Math.floor(i/7);if(o<4)return`${o}w ago`;const n=Math.floor(i/30);if(n<12)return`${n}mo ago`;return`${Math.floor(i/365)}y ago`},[]),de=s.useCallback(e=>{const s=new URLSearchParams(U);s.set("tab",e),s.delete("page"),F(s)},[U,F]),ce=s.useCallback(e=>{const s=new URLSearchParams(U);s.set("page",e.toString()),F(s),window.scrollTo({top:0,behavior:"smooth"})},[U,F]),me=s.useCallback(()=>{te(!0),E.submit({intent:"refresh-feed"},{method:"post"}),setTimeout(()=>{te(!1)},1e3)},[E]),xe=s.useCallback(e=>{G(e)},[G]),ue=s.useCallback(async(e,s)=>{let t=[];if(s.postComments&&s.postComments.length>0)t=s.postComments.map(e=>{let t={id:e.userId,username:e.username||"Unknown User",firstName:"",lastName:"",profileImage:"/default-avatar.png"};t=e.commenter?{id:e.commenter.id,username:e.commenter.username,firstName:e.commenter.firstName||"",lastName:e.commenter.lastName||"",profileImage:e.commenter.profileImage||"/default-avatar.png"}:_&&e.userId===_.id?{id:_.id,username:_.username,firstName:_.firstName||"",lastName:_.lastName||"",profileImage:_.profileImage||"/default-avatar.png"}:e.userId===s.user.id?{id:s.user.id,username:s.user.username,firstName:s.user.firstName,lastName:s.user.lastName,profileImage:s.user.profileImage}:{id:e.userId,username:e.username||"Unknown User",firstName:"",lastName:"",profileImage:"/default-avatar.png"};return{id:e.id,userId:e.userId,postId:e.postId,comment:e.comment,parentId:e.parentId,createdAt:e.created_at,updatedAt:e.updated_at,commenter:t,replies:[]}});else try{const s=await fetch(`/api/comments/posts/${e}/comments?include_replies=true`,{credentials:"include"});if(s.ok){t=((await s.json()).comments||[]).map(s=>({id:s.id,userId:s.userId||s.user_id||0,postId:s.postId||s.post_id||e,comment:s.comment,parentId:s.parentId||s.parent_id||null,createdAt:s.createdAt||s.created_at||"",updatedAt:s.updatedAt||s.updated_at||"",commenter:s.commenter||{id:s.userId||s.user_id||0,username:s.username||"unknown",firstName:s.firstName||s.first_name||"",lastName:s.lastName||s.last_name||"",profileImage:s.profileImage||s.profile_image_url||"/default-avatar.png"},replies:[]}))}}catch(a){}D(e,t)},[D,_]),he=s.useCallback(()=>{X(""),ee([])},[]);return M.error?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-orange-50 to-slate-100 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-sm border border-red-200 max-w-md mx-auto text-center",children:[e.jsx(h,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-red-800 mb-2",children:"Error Loading Posts"}),e.jsx("p",{className:"text-red-600 mb-4",children:M.error}),e.jsxs("button",{onClick:me,className:"inline-flex items-center gap-2 bg-orange-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-orange-600 transition-colors",disabled:se,children:[e.jsx(g,{size:18,className:se?"animate-spin":""}),"Try Again"]})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-orange-50 to-slate-100",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm border-b border-slate-200 sticky top-0 z-40",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("h1",{className:"text-xl font-bold text-slate-800",children:"Posts Feed"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[_&&e.jsxs(i,{to:"/posts/create",className:"inline-flex items-center gap-2 bg-gradient-to-r from-orange-500 to-slate-600 text-white px-4 py-2 rounded-lg font-medium hover:from-orange-600 hover:to-slate-700 transition-all duration-200 shadow-md hover:shadow-lg",children:[e.jsx(p,{size:18}),"Create Post"]}),e.jsx("button",{onClick:me,className:"p-2 rounded-lg text-slate-600 hover:text-slate-900 hover:bg-slate-100 transition-colors "+(se?"animate-spin":""),disabled:se,children:e.jsx(g,{size:20})})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold bg-gradient-to-r from-orange-600 to-slate-800 bg-clip-text text-transparent mb-4",children:"Community Posts"}),e.jsx("p",{className:"text-lg text-slate-600 max-w-2xl mx-auto",children:"Discover posts from the community and connect with users who share your interests."})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-1 mb-8 flex",children:[e.jsxs("button",{onClick:()=>de("all"),className:"flex-1 py-3 px-4 rounded-lg font-medium transition-colors "+("all"===ae?"bg-orange-100 text-orange-700":"text-slate-600 hover:text-slate-900 hover:bg-slate-50"),children:["All Posts (",(null==(u=M.stats)?void 0:u.totalPosts)||0,")"]}),e.jsxs("button",{onClick:()=>de("similar"),className:"flex-1 py-3 px-4 rounded-lg font-medium transition-colors "+("similar"===ae?"bg-orange-100 text-orange-700":"text-slate-600 hover:text-slate-900 hover:bg-slate-50"),children:["Similar Users (",(null==(z=M.stats)?void 0:z.similarPosts)||0,")"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx(b,{size:24,className:"text-orange-600"})}),e.jsx("h3",{className:"text-2xl font-bold text-slate-900",children:"all"===ae?(null==(L=M.stats)?void 0:L.totalPosts)||0:(null==(P=M.stats)?void 0:P.similarUsers)||0}),e.jsx("p",{className:"text-slate-600",children:"all"===ae?"Total Posts":"Similar Users"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx(f,{size:24,className:"text-blue-600"})}),e.jsx("h3",{className:"text-2xl font-bold text-slate-900",children:"all"===ae?"All":(null==(S=M.stats)?void 0:S.similarPosts)||0}),e.jsx("p",{className:"text-slate-600",children:"all"===ae?"Community":"Similar Posts"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx(j,{size:24,className:"text-purple-600"})}),e.jsx("h3",{className:"text-2xl font-bold text-slate-900",children:(null==($=M.stats)?void 0:$.userTags)||0}),e.jsx("p",{className:"text-slate-600",children:"Your Tags"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-8",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(N,{size:20,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search posts by title, content, or username...",value:W,onChange:e=>X(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors"})]})}),e.jsxs("div",{className:"flex items-center gap-1 bg-slate-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>K("grid"),className:"p-2 rounded-md transition-colors "+("grid"===J?"bg-white shadow-sm text-orange-600":"text-slate-600 hover:text-slate-900"),children:e.jsx(v,{size:18})}),e.jsx("button",{onClick:()=>K("list"),className:"p-2 rounded-md transition-colors "+("list"===J?"bg-white shadow-sm text-orange-600":"text-slate-600 hover:text-slate-900"),children:e.jsx(w,{size:18})})]}),(W||Z.length>0)&&e.jsx("button",{onClick:he,className:"px-4 py-2 text-orange-600 hover:text-orange-700 font-medium transition-colors",children:"Clear Filters"})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-slate-200",children:e.jsxs("p",{className:"text-sm text-slate-600",children:["Showing"," ",e.jsx("span",{className:"font-semibold",children:oe.length})," ","posts",W&&` matching "${W}"`,"similar"===ae&&" from similar users"]})})]}),0===oe.length?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-24 h-24 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(k,{size:32,className:"text-slate-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-2",children:"No posts found"}),e.jsx("p",{className:"text-slate-600 mb-6 max-w-md mx-auto",children:W?"Try adjusting your search terms to find more posts.":"similar"===ae&&M.message?M.message:"No posts are currently available. Check back later!"}),_&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(i,{to:"/posts/create",className:"inline-flex items-center gap-2 bg-gradient-to-r from-orange-500 to-slate-600 text-white px-6 py-3 rounded-lg font-medium hover:from-orange-600 hover:to-slate-700 transition-all duration-200",children:[e.jsx(p,{size:20}),"Create First Post"]}),"similar"===ae&&(!_.usersTags||0===_.usersTags.length)&&e.jsx("div",{className:"mt-4",children:e.jsxs(i,{to:`/users/${_.id}/profile/update`,className:"inline-flex items-center gap-2 bg-blue-500 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-600 transition-colors",children:[e.jsx(b,{size:20}),"Add Tags to Your Profile"]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid"===J?"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6":"space-y-6",children:oe.map(s=>e.jsx(T,{post:s,viewMode:J,formatTimeAgo:ne,handleCommentClick:ue,handleLikesClick:xe,likeState:Y.get(s.id),setLikeState:q,sessionUser:_},s.id))}),ie.pages>1&&e.jsx("div",{className:"flex justify-center mt-8",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ce(1),disabled:1===le,className:"px-3 py-1 rounded-md border border-slate-300 text-slate-700 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"First"}),e.jsx("button",{onClick:()=>ce(le-1),disabled:1===le,className:"p-1 rounded-md border border-slate-300 text-slate-700 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(C,{size:18})}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,ie.pages)},(s,t)=>{let a;return a=ie.pages<=5||le<=3?t+1:le>=ie.pages-2?ie.pages-4+t:le-2+t,e.jsx("button",{onClick:()=>ce(a),className:"w-8 h-8 flex items-center justify-center rounded-md "+(le===a?"bg-orange-500 text-white":"border border-slate-300 text-slate-700 hover:bg-slate-50"),children:a},a)})}),e.jsx("button",{onClick:()=>ce(le+1),disabled:le===ie.pages,className:"p-1 rounded-md border border-slate-300 text-slate-700 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(y,{size:18})}),e.jsx("button",{onClick:()=>ce(ie.pages),disabled:le===ie.pages,className:"px-3 py-1 rounded-md border border-slate-300 text-slate-700 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Last"})]})})]}),"similar"===ae&&M.message&&0===oe.length&&e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4 mt-8 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-orange-600 mb-2",children:[e.jsx(I,{size:20}),e.jsx("h3",{className:"font-semibold",children:"Personalized Feed"})]}),e.jsx("p",{className:"text-orange-700",children:M.message}),e.jsxs(i,{to:`/users/${null==_?void 0:_.id}/profile/update`,className:"inline-flex items-center gap-2 bg-orange-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-orange-600 transition-colors mt-4",children:[e.jsx(b,{size:18}),"Add Tags to Profile"]})]})]}),e.jsx(m,{isOpen:O.isOpen,onClose:R,postId:O.postId||0,initialComments:O.comments}),V&&B&&e.jsx(x,{isOpen:V,onClose:H,postId:B,initialCount:(null==(A=Y.get(B))?void 0:A.likeCount)||0})]})},T=({post:s,viewMode:t,formatTimeAgo:a,handleCommentClick:l,handleLikesClick:r,likeState:o,setLikeState:n})=>{const d=s,c=()=>{l(s.id,d)};return e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden hover:shadow-lg transition-all duration-300 "+("list"===t?"p-6":""),children:"grid"===t?e.jsxs("div",{children:[e.jsx("div",{className:"relative",children:e.jsx("img",{src:s.image,alt:s.title,className:"w-full h-64 object-cover",loading:"lazy"})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(i,{to:`/users/${s.user.id}`,className:"flex-shrink-0",children:e.jsx("img",{src:s.user.profileImage,alt:s.user.username,className:"w-10 h-10 rounded-full object-cover border-2 border-slate-200",loading:"lazy",onError:e=>{e.target.src="/default-avatar.png"}})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx(i,{to:`/users/${s.user.id}`,className:"font-semibold text-slate-900 hover:text-orange-600 transition-colors block truncate",children:s.user.username}),e.jsxs("div",{className:"flex items-center text-xs text-slate-500",children:[e.jsx(z,{size:12,className:"mr-1"}),e.jsx("span",{children:a(s.createdAt)})]})]})]}),e.jsxs(i,{to:`/posts/${s.id}`,className:"block group",children:[e.jsx("h3",{className:"font-bold text-lg text-slate-900 group-hover:text-orange-600 transition-colors mb-2 line-clamp-2",children:s.title}),e.jsx("p",{className:"text-slate-600 text-sm line-clamp-3 mb-4",children:s.caption})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(u,{postId:s.id,initialLikeCount:(null==o?void 0:o.likeCount)||s.likes,initialIsLiked:(null==o?void 0:o.isLiked)||!1,onLikeToggle:(e,s,t)=>{n(e,s,t)},onLikesClick:r,size:18,disabled:null==o?void 0:o.isLoading}),e.jsxs("button",{onClick:c,className:"flex items-center gap-1 text-slate-500 hover:text-blue-500 transition-colors",children:[e.jsx(k,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:s.comments})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"text-slate-400 hover:text-orange-500 transition-colors",children:e.jsx(L,{size:18})}),e.jsx("button",{className:"text-slate-400 hover:text-green-500 transition-colors",children:e.jsx(P,{size:18})})]})]})]})]}):e.jsxs("div",{className:"flex gap-6",children:[e.jsx(i,{to:`/posts/${s.id}`,className:"flex-shrink-0 w-32 h-32 sm:w-48 sm:h-48 overflow-hidden rounded-lg",children:e.jsx("img",{src:s.image,alt:s.title,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-300",loading:"lazy"})}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(i,{to:`/users/${s.user.id}`,className:"flex-shrink-0",children:e.jsx("img",{src:s.user.profileImage,alt:s.user.username,className:"w-8 h-8 rounded-full object-cover border-2 border-slate-200",loading:"lazy",onError:e=>{e.target.src="/default-avatar.png"}})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx(i,{to:`/users/${s.user.id}`,className:"font-semibold text-slate-900 hover:text-orange-600 transition-colors block truncate",children:s.user.username}),e.jsxs("div",{className:"flex items-center text-xs text-slate-500",children:[e.jsx(z,{size:12,className:"mr-1"}),e.jsx("span",{children:a(s.createdAt)})]})]})]}),e.jsxs(i,{to:`/posts/${s.id}`,className:"block group flex-1",children:[e.jsx("h3",{className:"font-bold text-lg text-slate-900 group-hover:text-orange-600 transition-colors mb-2",children:s.title}),e.jsx("p",{className:"text-slate-600 text-sm line-clamp-2 mb-4",children:s.caption})]}),e.jsxs("div",{className:"flex items-center justify-between mt-auto",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(u,{postId:s.id,initialLikeCount:(null==o?void 0:o.likeCount)||s.likes,initialIsLiked:(null==o?void 0:o.isLiked)||!1,onLikeToggle:(e,s,t)=>{n(e,s,t)},onLikesClick:r,size:16,disabled:null==o?void 0:o.isLoading}),e.jsxs("button",{onClick:c,className:"flex items-center gap-1 text-slate-500 hover:text-blue-500 transition-colors",children:[e.jsx(k,{size:16}),e.jsx("span",{className:"text-sm font-medium",children:s.comments})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"text-slate-400 hover:text-orange-500 transition-colors",children:e.jsx(L,{size:16})}),e.jsx("button",{className:"text-slate-400 hover:text-green-500 transition-colors",children:e.jsx(P,{size:16})})]})]})]})]})})};export{S as default};
